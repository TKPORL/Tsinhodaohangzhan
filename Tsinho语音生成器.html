<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F2F2F7">
    <title>Tsinhoè¯­éŸ³ç”Ÿæˆå™¨</title>
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-bg: #F2F2F7;
            --ios-card: rgba(255, 255, 255, 0.82);
            --text-primary: #1c1c1e;
            --text-secondary: #8E8E93;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-left: env(safe-area-inset-left);
            --safe-right: env(safe-area-inset-right);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
        }

        /* åŸºç¡€å“åº”å¼è®¾ç½® */
        html {
            font-size: clamp(14px, 2.5vw, 18px);
        }

        body {
            background-color: var(--ios-bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(0, 122, 255, 0.06) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(175, 82, 222, 0.06) 0px, transparent 50%);
            min-height: 100dvh;
            min-height: 100vh; /* å›é€€ */
            color: var(--text-primary);
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            background-attachment: fixed;
            padding: var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
        }

        /* ä¸»å®¹å™¨ - è‡ªé€‚åº”æ‰€æœ‰å±å¹•æ¯”ä¾‹ */
        .app-container {
            width: min(100%, 800px);
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            padding: clamp(16px, 4vw, 40px);
            gap: clamp(16px, 3vw, 32px);
            position: relative;
        }

        /* é¡µçœ‰ - è‡ªé€‚åº”ç¼©æ”¾ */
        .app-header {
            text-align: center;
            margin-bottom: clamp(8px, 2vh, 16px);
            padding-top: clamp(8px, 2vh, 20px);
        }

        .app-title {
            font-size: clamp(28px, 8vw, 56px);
            font-weight: 800;
            letter-spacing: -0.03em;
            color: var(--text-primary);
            margin-bottom: clamp(6px, 1.5vh, 12px);
            background: linear-gradient(135deg, #1c1c1e, #3a3a3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .app-subtitle {
            font-size: clamp(14px, 4vw, 20px);
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1.4;
        }

        /* ä¸»å¡ç‰‡ - ç»ç’ƒæ‹Ÿæ€æ•ˆæœ */
        .main-card {
            background: var(--ios-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: clamp(24px, 6vw, 40px);
            padding: clamp(20px, 5vw, 36px);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 4px 24px rgba(0,0,0,0.06);
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: clamp(20px, 4vh, 32px);
        }

        /* è¡¨å•åŒºå— */
        .form-section {
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 2vh, 20px);
        }

        .form-label {
            font-size: clamp(16px, 4.5vw, 22px);
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-label::before {
            content: '';
            width: 4px;
            height: clamp(18px, 4vw, 24px);
            background: var(--ios-blue);
            border-radius: 2px;
        }

        /* è§’è‰²ç½‘æ ¼ - è‡ªé€‚åº”åˆ—æ•° */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(100px, 28vw, 140px), 1fr));
            gap: clamp(10px, 2.5vw, 16px);
            max-height: clamp(300px, 40vh, 450px);
            overflow-y: auto;
            padding: 4px;
            -webkit-overflow-scrolling: touch;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .character-grid::-webkit-scrollbar {
            width: 6px;
        }
        .character-grid::-webkit-scrollbar-track {
            background: transparent;
        }
        .character-grid::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.15);
            border-radius: 3px;
        }

        .character-item {
            background: rgba(118, 118, 128, 0.12);
            border-radius: clamp(16px, 4vw, 24px);
            padding: clamp(12px, 3vw, 20px) clamp(8px, 2vw, 12px);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            min-height: clamp(60px, 15vw, 80px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
        }

        .character-item:active {
            transform: scale(0.96);
            background: rgba(118, 118, 128, 0.2);
        }

        .character-item.selected {
            background: var(--ios-blue);
            border-color: rgba(0, 86, 179, 0.5);
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.25);
        }

        .character-item .name {
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .character-item.selected .name {
            color: white;
        }

        .character-item .category {
            font-size: clamp(10px, 2.5vw, 12px);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .character-item.selected .category {
            color: rgba(255, 255, 255, 0.85);
        }

        /* æ–‡æœ¬è¾“å…¥åŒº - è‡ªé€‚åº”é«˜åº¦ */
        .text-input-wrapper {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: clamp(120px, 25vh, 200px);
            max-height: clamp(200px, 35vh, 300px);
            padding: clamp(16px, 4vw, 24px);
            background: rgba(118, 118, 128, 0.12);
            border: 2px solid transparent;
            border-radius: clamp(20px, 5vw, 28px);
            font-size: clamp(15px, 4vw, 18px);
            line-height: 1.6;
            color: var(--text-primary);
            resize: vertical;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .text-input:focus {
            background: rgba(118, 118, 128, 0.18);
            border-color: var(--ios-blue);
        }

        .char-count {
            text-align: right;
            font-size: clamp(12px, 3vw, 14px);
            color: var(--text-secondary);
            margin-top: 8px;
            padding-right: 12px;
            font-weight: 500;
        }

        /* æŒ‰é’®ç»„ - è‡ªé€‚åº”å¸ƒå±€ */
        .button-group {
            display: flex;
            gap: clamp(12px, 3vw, 20px);
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: clamp(14px, 4vw, 20px) clamp(20px, 5vw, 32px);
            border-radius: clamp(16px, 4vw, 24px);
            font-size: clamp(15px, 4vw, 18px);
            font-weight: 700;
            cursor: pointer;
            border: none;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(8px, 2vw, 12px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-height: clamp(48px, 12vw, 56px);
        }

        .btn svg {
            width: clamp(18px, 4.5vw, 24px);
            height: clamp(18px, 4.5vw, 24px);
            flex-shrink: 0;
        }

        .btn-primary {
            background: var(--ios-blue);
            color: white;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .btn-primary:active {
            transform: scale(0.96);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.25);
        }

        .btn-secondary {
            background: rgba(118, 118, 128, 0.12);
            color: var(--text-primary);
        }

        .btn-secondary:active {
            background: rgba(118, 118, 128, 0.2);
            transform: scale(0.96);
        }

        .btn-loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: clamp(20px, 5vw, 24px);
            height: clamp(20px, 5vw, 24px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æ’­æ”¾å™¨å¡ç‰‡ */
        .player-card {
            background: var(--ios-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: clamp(24px, 6vw, 40px);
            padding: clamp(20px, 5vw, 32px);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 4px 24px rgba(0,0,0,0.06);
            display: none;
            flex-direction: column;
            gap: clamp(16px, 3vh, 24px);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .player-card.active {
            display: flex;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: clamp(16px, 4vw, 24px);
        }

        .player-artwork {
            width: clamp(56px, 14vw, 80px);
            height: clamp(56px, 14vw, 80px);
            background: linear-gradient(135deg, #5AC8FA, var(--ios-blue));
            border-radius: clamp(16px, 4vw, 24px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(28px, 7vw, 40px);
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2);
        }

        .player-meta {
            flex: 1;
            min-width: 0;
        }

        .player-meta h3 {
            font-size: clamp(18px, 5vw, 24px);
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-meta p {
            font-size: clamp(13px, 3.5vw, 15px);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .audio-container {
            background: rgba(118, 118, 128, 0.12);
            border-radius: clamp(16px, 4vw, 24px);
            padding: clamp(12px, 3vw, 20px);
            overflow: hidden;
        }

        audio {
            width: 100%;
            height: clamp(40px, 10vw, 54px);
            display: block;
        }

        .download-btn {
            width: 100%;
            padding: clamp(14px, 4vw, 20px);
            background: var(--ios-green);
            color: white;
            border-radius: clamp(16px, 4vw, 24px);
            font-size: clamp(15px, 4vw, 18px);
            font-weight: 700;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(8px, 2vw, 12px);
            transition: all 0.2s ease;
            box-shadow: 0 4px 16px rgba(52, 199, 89, 0.25);
            min-height: clamp(48px, 12vw, 56px);
        }

        .download-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(52, 199, 89, 0.2);
        }

        .download-btn svg {
            width: clamp(18px, 4.5vw, 24px);
            height: clamp(18px, 4.5vw, 24px);
            flex-shrink: 0;
        }

        /* é”™è¯¯æç¤º */
        .error-hint {
            background: rgba(255, 59, 48, 0.1);
            border-radius: clamp(16px, 4vw, 20px);
            padding: clamp(12px, 3vw, 16px) clamp(16px, 4vw, 20px);
            display: none;
            align-items: center;
            gap: clamp(10px, 2.5vw, 14px);
            border: 1px solid rgba(255, 59, 48, 0.2);
        }

        .error-hint.show {
            display: flex;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error-hint svg {
            width: clamp(20px, 5vw, 24px);
            height: clamp(20px, 5vw, 24px);
            color: var(--ios-red);
            flex-shrink: 0;
        }

        .error-hint span {
            font-size: clamp(13px, 3.5vw, 15px);
            color: var(--ios-red);
            font-weight: 500;
            line-height: 1.4;
        }

        /* Toast æç¤º - å±…ä¸­è‡ªé€‚åº” */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            color: white;
            padding: clamp(16px, 4vw, 24px) clamp(24px, 6vw, 40px);
            border-radius: clamp(16px, 4vw, 24px);
            font-size: clamp(14px, 4vw, 17px);
            font-weight: 600;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            white-space: nowrap;
            max-width: 90vw;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .toast.error {
            background: rgba(255, 59, 48, 0.95);
        }

        /* æ¨ªå±/è¶…å®½å±ä¼˜åŒ– */
        @media (min-aspect-ratio: 16/9) and (max-height: 600px) {
            .app-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: flex-start;
                max-width: 100%;
                gap: 20px;
            }
            
            .app-header {
                width: 100%;
                margin-bottom: 0;
            }
            
            .main-card {
                flex: 1;
                min-width: 300px;
                max-width: 50%;
            }
            
            .player-card {
                flex: 1;
                min-width: 300px;
                max-width: 45%;
            }
            
            .character-grid {
                max-height: 200px;
            }
            
            .text-input {
                min-height: 100px;
            }
        }

        /* å°å±æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 380px) {
            html {
                font-size: 13px;
            }
            
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* å¤§å±æ¡Œé¢ä¼˜åŒ– */
        @media (min-width: 1200px) {
            body {
                align-items: center;
            }
            
            .app-container {
                min-height: auto;
                padding: 40px;
            }
        }

        /* æŠ˜å å±/ç‰¹æ®Šæ¯”ä¾‹é€‚é… */
        @media (max-aspect-ratio: 9/16) {
            /* è¶…é•¿å±æ‰‹æœº */
            .app-container {
                justify-content: flex-start;
            }
        }

        /* ç¦ç”¨æ–‡æœ¬é€‰æ‹©ï¼ˆç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–ï¼‰ */
        @media (pointer: coarse) {
            .character-item, .btn {
                user-select: none;
                -webkit-user-select: none;
            }
        }

        /* æš—è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            :root {
                --ios-bg: #000000;
                --ios-card: rgba(28, 28, 30, 0.85);
                --text-primary: #ffffff;
                --text-secondary: #8E8E93;
            }
            
            body {
                background-image: 
                    radial-gradient(at 0% 0%, rgba(0, 122, 255, 0.15) 0px, transparent 50%),
                    radial-gradient(at 100% 100%, rgba(175, 82, 222, 0.15) 0px, transparent 50%);
            }
            
            .character-item, .text-input, .btn-secondary {
                background: rgba(118, 118, 128, 0.24);
            }
            
            .text-input {
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡µçœ‰ -->
        <div class="app-header">
            <h1 class="app-title">Tsinhoè¯­éŸ³ç”Ÿæˆå™¨</h1>
            <p class="app-subtitle">é€‰æ‹©è§’è‰²ï¼Œè¾“å…¥æ–‡æœ¬ï¼Œå³åˆ»ç”Ÿæˆ AI è¯­éŸ³</p>
        </div>

        <!-- ä¸»å¡ç‰‡ -->
        <div class="main-card">
            <!-- è§’è‰²é€‰æ‹© -->
            <div class="form-section">
                <label class="form-label">é…éŸ³è§’è‰²</label>
                <div class="character-grid" id="characterGrid"></div>
            </div>

            <!-- æ–‡æœ¬è¾“å…¥ -->
            <div class="form-section">
                <label class="form-label">æ–‡æœ¬å†…å®¹</label>
                <div class="text-input-wrapper">
                    <textarea class="text-input" id="textInput" placeholder="è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬..." oninput="updateCharCount()"></textarea>
                    <div class="char-count" id="charCount">0 å­—</div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="button-group">
                <button class="btn btn-primary" id="generateBtn" onclick="generateVoice()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    ç”Ÿæˆè¯­éŸ³
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    æ¸…ç©º
                </button>
            </div>

            <!-- é”™è¯¯æç¤º -->
            <div class="error-hint" id="errorHint">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span id="errorText"></span>
            </div>
        </div>

        <!-- æ’­æ”¾å™¨å¡ç‰‡ -->
        <div class="player-card" id="playerCard">
            <div class="player-header">
                <div class="player-artwork">ğŸµ</div>
                <div class="player-meta">
                    <h3 id="playerTitle">è§’è‰²åç§°</h3>
                    <p id="playerSubtitle">ç”Ÿæˆå®Œæ¯• Â· ç‚¹å‡»æ’­æ”¾</p>
                </div>
            </div>
            <div class="audio-container">
                <audio id="audioPlayer" controls></audio>
            </div>
            <a class="download-btn" id="downloadLink" href="#" download>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                ä¸‹è½½éŸ³é¢‘
            </a>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastMsg"></span>
    </div>

    <script>
        // è§’è‰²æ•°æ®ï¼ˆä¿æŒåŸæœ‰æ•°æ®ï¼‰
        const characters = [
            { name: "çŸ¥æ€§å¥³å£°", category: "çƒ­é—¨æ¨è" },
            { name: "ç´«è–‡", category: "å½±è§†è§’è‰²" },
            { name: "å®¹å¬·å¬·", category: "å½±è§†è§’è‰²" },
            { name: "å¥³å„¿å›½ç‹", category: "å½±è§†è§’è‰²" },
            { name: "å…«æˆ’", category: "å½±è§†è§’è‰²" },
            { name: "çŒ´å“¥", category: "å½±è§†è§’è‰²" },
            { name: "çš‡ä¸Š", category: "å½±è§†è§’è‰²" },
            { name: "é»›ç‰", category: "å½±è§†è§’è‰²" },
            { name: "æ­¦åˆ™å¤©", category: "å½±è§†è§’è‰²" },
            { name: "é¡¾å§", category: "å½±è§†è§’è‰²" },
            { name: "TVBå¥³å£°", category: "å½±è§†è§’è‰²" },
            { name: "è¯‘åˆ¶ç‰‡ç”·", category: "å½±è§†è§’è‰²" },
            { name: "ä½©å¥‡çŒª", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "æ¨±æ¡ƒä¸¸å­", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "æ‡’å°ç¾Š", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "ç†ŠäºŒ", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "å°é­”ç«¥", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "åŠ¨æ¼«æµ·ç»µ", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "åŠ¨æ¼«å°æ–°", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "èŒå¨ƒ", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "å°å¥³å­©", category: "åŠ¨æ¼«è§’è‰²" },
            { name: "æ–°é—»ç”·å£°", category: "ä¸“ä¸šé…éŸ³" },
            { name: "æ–°é—»å¥³å£°", category: "ä¸“ä¸šé…éŸ³" },
            { name: "çºªå½•ç‰‡è§£è¯´", category: "ä¸“ä¸šé…éŸ³" },
            { name: "å¹¿å‘Šç”·å£°", category: "ä¸“ä¸šé…éŸ³" },
            { name: "ä¿ƒé”€ç”·å£°", category: "ä¸“ä¸šé…éŸ³" },
            { name: "å•†åŠ¡æ®·è¯­", category: "ä¸“ä¸šé…éŸ³" },
            { name: "çŸ¥è¯†è®²è§£", category: "ä¸“ä¸šé…éŸ³" },
            { name: "äº¬è…”", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "ç²¤è¯­ç”·å£°", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "å¤©æ´¥å°å“¥", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "æ²³å—å¤§å”", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "è¥¿å®‰æŒæŸœ", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "å°æ¹¾ç”·ç”Ÿ", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "å°æ¹¾å¥³ç”Ÿ", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "ä¸œåŒ—è€é“", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "é‡åº†å°ä¼™", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "å¹¿è¥¿è¡¨å“¥", category: "æ–¹è¨€ç‰¹è‰²" },
            { name: "å¿«æ¿", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å•å£ç›¸å£°", category: "ç‰¹è‰²é£æ ¼" },
            { name: "è¯´å”±å°å“¥", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å¿ƒçµé¸¡æ±¤", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç«¥è¯è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç½‘æ–‡è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ‚¬ç–‘è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç”µç«è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "èµ›äº‹è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ä¹’ä¹“è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ¸¸æˆè§£è¯´ç”·", category: "ç‰¹è‰²é£æ ¼" },
            { name: "åŠ¨æ¼«è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "èˆŒå°–è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "è§£è¯´å°å¸…", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç”œç¾è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ²‰ç¨³è§£è¯´", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å¨±ä¹æ‰’å¦¹", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å°å“è‰ºæœ¯å®¶", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å’†å“®å“¥", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ¨±èŠ±å°å“¥", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç”œç¾æ‚¦æ‚¦", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å¼ºåŠ¿å¦¹", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ç†æ™ºå§", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å¿ƒæœºå¾¡å§", category: "ç‰¹è‰²é£æ ¼" },
            { name: "ä¸Šæµ·é˜¿å§¨", category: "ç‰¹è‰²é£æ ¼" },
            { name: "è€å©†å©†", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å¤é£ç”·ä¸»", category: "ç‰¹è‰²é£æ ¼" },
            { name: "éœ¸æ€»", category: "ç‰¹è‰²é£æ ¼" },
            { name: "é›…ç—å¤§å”", category: "ç‰¹è‰²é£æ ¼" },
            { name: "äº²åˆ‡å¥³å£°", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ¸©æŸ”æ·‘å¥³", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ–‡è‰ºå¥³å£°", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å°‘å„¿æ•…äº‹", category: "ç‰¹è‰²é£æ ¼" },
            { name: "å°å§å§", category: "ç‰¹è‰²é£æ ¼" },
            { name: "é˜³å…‰ç”·ç”Ÿ", category: "ç‰¹è‰²é£æ ¼" },
            { name: "æ­Œå”±å¥³ç‹", category: "æ­Œå”±ç±»" },
            { name: "æ­Œå”±è¾¾äºº", category: "æ­Œå”±ç±»" },
            { name: "æƒ…æ­Œç‹", category: "æ­Œå”±ç±»" },
            { name: "æ‘‡æ»šç”·ç”Ÿ", category: "æ­Œå”±ç±»" },
            { name: "ç”œç¾å¥³å­©", category: "æ­Œå”±ç±»" },
            { name: "æ¿€æ‰¬ç”·å£°", category: "æ­Œå”±ç±»" },
            { name: "æ˜¥èŠ‚ç”œå¦¹", category: "æ­Œå”±ç±»" },
            { name: "æ˜¥æ—¥ç”œå¦¹", category: "æ­Œå”±ç±»" },
            { name: "æ¸…æ–°æ­Œæ‰‹", category: "æ­Œå”±ç±»" },
            { name: "æ°´æœèˆæ›²", category: "æ­Œå”±ç±»" },
            { name: "åº·åº·èˆæ›²", category: "æ­Œå”±ç±»" },
            { name: "åº·å®šæƒ…æ­Œ", category: "æ­Œå”±ç±»" }
        ];

        let currentSelection = null;
        const failedCharacters = new Set();

        // åˆå§‹åŒ–
        function init() {
            renderCharacterGrid();
            
            // æ£€æµ‹å±å¹•æ¯”ä¾‹å˜åŒ–å¹¶è‡ªåŠ¨è°ƒæ•´
            window.addEventListener('resize', handleResize);
            handleResize(); // åˆå§‹æ£€æµ‹
            
            // æ£€æµ‹è®¾å¤‡ç±»å‹ä¼˜åŒ–äº¤äº’
            detectDevice();
        }

        // æ¸²æŸ“è§’è‰²ç½‘æ ¼
        function renderCharacterGrid() {
            const grid = document.getElementById('characterGrid');
            grid.innerHTML = '';

            characters.forEach(item => {
                const div = document.createElement('div');
                div.className = 'character-item';
                div.innerHTML = `
                    <span class="name">${item.name}</span>
                    <span class="category">${item.category}</span>
                `;
                div.onclick = () => selectCharacter(item, div);
                grid.appendChild(div);
            });
        }

        // é€‰æ‹©è§’è‰²
        function selectCharacter(item, element) {
            if (failedCharacters.has(item.name)) {
                showToast(`"${item.name}" æš‚æ—¶ä¸å¯ç”¨`, true);
                return;
            }

            document.querySelectorAll('.character-item').forEach(el => {
                el.classList.remove('selected');
            });

            element.classList.add('selected');
            currentSelection = item;
            hideError();
            showToast(`å·²é€‰æ‹© "${item.name}"`);
        }

        // æ›´æ–°å­—æ•°
        function updateCharCount() {
            const len = document.getElementById('textInput').value.length;
            document.getElementById('charCount').textContent = `${len} å­—`;
        }

        // æ¸…ç©º
        function clearAll() {
            document.getElementById('textInput').value = '';
            updateCharCount();
            hidePlayer();
            hideError();
            currentSelection = null;
            document.querySelectorAll('.character-item').forEach(el => {
                el.classList.remove('selected');
            });
            showToast('å·²æ¸…ç©º');
        }

        // éšè—æ’­æ”¾å™¨
        function hidePlayer() {
            document.getElementById('playerCard').classList.remove('active');
            const audio = document.getElementById('audioPlayer');
            audio.pause();
            audio.src = '';
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(msg) {
            const hint = document.getElementById('errorHint');
            document.getElementById('errorText').textContent = msg;
            hint.classList.add('show');
        }

        // éšè—é”™è¯¯
        function hideError() {
            document.getElementById('errorHint').classList.remove('show');
        }

        // æ˜¾ç¤ºToast
        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            toast.className = isError ? 'toast error show' : 'toast show';
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ç”Ÿæˆè¯­éŸ³
        async function generateVoice() {
            const text = document.getElementById('textInput').value.trim();

            if (!currentSelection) {
                showError('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé…éŸ³è§’è‰²');
                return;
            }

            if (!text) {
                showError('è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬å†…å®¹');
                return;
            }

            const btn = document.getElementById('generateBtn');
            btn.classList.add('btn-loading');
            btn.disabled = true;

            try {
                const apiUrl = `https://api.milorapart.top/apis/AIvoice/?text=${encodeURIComponent(text)}&speaker=${encodeURIComponent(currentSelection.name)}`;
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                const response = await fetch(apiUrl, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();

                if (data.code === 200 && data.url && data.url.trim() !== '') {
                    const audio = document.getElementById('audioPlayer');
                    audio.src = data.url;
                    document.getElementById('playerTitle').textContent = currentSelection.name;
                    document.getElementById('playerSubtitle').textContent = 'ç”Ÿæˆå®Œæ¯• Â· ç‚¹å‡»æ’­æ”¾';
                    document.getElementById('downloadLink').href = data.url;
                    document.getElementById('downloadLink').download = `voice_${currentSelection.name}_${Date.now()}.mp3`;
                    document.getElementById('playerCard').classList.add('active');

                    hideError();
                    showToast('è¯­éŸ³ç”ŸæˆæˆåŠŸï¼');
                    
                    // æ»šåŠ¨åˆ°æ’­æ”¾å™¨ï¼ˆç§»åŠ¨ç«¯ä½“éªŒä¼˜åŒ–ï¼‰
                    setTimeout(() => {
                        document.getElementById('playerCard').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest' 
                        });
                    }, 100);
                } else if (data.code === 400 || data.code === 404 || data.msg) {
                    throw new Error(data.msg || 'è¯¥è§’è‰²æš‚æ—¶ä¸å¯ç”¨');
                } else {
                    throw new Error('æœªè¿”å›æœ‰æ•ˆçš„éŸ³é¢‘åœ°å€');
                }

            } catch (error) {
                if (currentSelection && error.message.includes('ä¸å¯ç”¨')) {
                    failedCharacters.add(currentSelection.name);
                }
                showError(`ç”Ÿæˆå¤±è´¥: ${error.message}`);
                showToast('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', true);
            } finally {
                btn.classList.remove('btn-loading');
                btn.disabled = false;
            }
        }

        // å±å¹•æ¯”ä¾‹è‡ªé€‚åº”å¤„ç†
        function handleResize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const ratio = width / height;
            const container = document.querySelector('.app-container');
            
            // æ ¹æ®æ¯”ä¾‹åŠ¨æ€è°ƒæ•´ï¼ˆå·²å¤§éƒ¨åˆ†é€šè¿‡CSSå¤„ç†ï¼Œæ­¤å¤„åšé¢å¤–é€»è¾‘ï¼‰
            if (ratio > 2) {
                // è¶…å®½å±ï¼ˆå¦‚æŠ˜å å±å±•å¼€ï¼‰
                container.style.maxWidth = '100%';
            } else if (ratio < 0.5) {
                // è¶…é•¿å±
                container.style.padding = '12px';
            } else {
                // æ­£å¸¸æ¯”ä¾‹
                container.style.maxWidth = '';
                container.style.padding = '';
            }
            
            // åŠ¨æ€è°ƒæ•´å­—ä½“åŸºå‡†
            const baseSize = Math.min(width / 25, height / 40, 18);
            document.documentElement.style.fontSize = `${Math.max(14, baseSize)}px`;
        }

        // è®¾å¤‡æ£€æµ‹ä¸ä¼˜åŒ–
        function detectDevice() {
            const isTouch = window.matchMedia('(pointer: coarse)').matches;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isTouch || isMobile) {
                // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šé˜²æ­¢åŒå‡»ç¼©æ”¾
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                // iOS é”®ç›˜å¤„ç†
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    document.addEventListener('focusin', (e) => {
                        if (e.target.tagName === 'TEXTAREA') {
                            setTimeout(() => {
                                e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 300);
                        }
                    });
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>